(function(e){e.bigfoot=function(x){var s,d=e.extend({actionOriginalFN:"hide",activateCallback:function(){},activateOnHover:!1,allowMultipleFN:!1,appendPopoversTo:void 0,breakpoints:{},deleteOnUnhover:!1,hoverDelay:250,numberResetSelector:void 0,popoverDeleteDelay:300,popoverCreateDelay:100,positionNextToBlock:!0,positionContent:!0,preventPageScroll:!0,scope:!1,useFootnoteOnlyOnce:!0,contentMarkup:'<aside class="footnote-content bottom"data-footnote-number="{{FOOTNOTENUM}}" data-footnote-identifier="{{FOOTNOTEID}}" alt="Footnote {{FOOTNOTENUM}}"><div class="footnote-main-wrapper"><div class="footnote-content-wrapper">{{FOOTNOTECONTENT}}</div></div><div class="tooltip"></div></aside>',
buttonMarkup:'<a href="#" class="footnote-button" id="{{SUP:data-footnote-backlink-ref}}" data-footnote-number="{{FOOTNOTENUM}}" data-footnote-identifier="{{FOOTNOTEID}}" alt="See Footnote {{FOOTNOTENUM}}" rel="footnote"data-footnote-content="{{FOOTNOTECONTENT}}"><span class="footnote-circle" data-footnote-number="{{FOOTNOTENUM}}"></span><span class="footnote-circle"></span><span class="footnote-circle"></span></a>'},x),A=function(){var a=e(!d.scope?'a[href*="#"]':d.scope+' a[href*="#"]').filter(function(){var a=
e(this),b=a.attr("rel");if(!b||"null"==b)b="";return(a.attr("href")+b).match(/(fn|footnote|note)[:\-_\d]/gi)&&1>a.closest("[class*=footnote]:not(a):not(sup)").length}),b=[],c=[],g=[],h,f;y(a,c);e(c).each(function(){h=e(this).attr("data-footnote-ref").replace(/[:.+~*\]\[]/g,"\\$&");d.useFootnoteOnlyOnce&&(h+=":not(.footnote-processed)");f=e(h).closest("li");0<f.length&&(b.push(f.first().addClass("footnote-processed")),g.push(this))});for(var l,k,a=1,m,n,q,p=0;p<b.length;p++)switch(m=z(e(b[p]).html().trim(),
e(g[p]).data("footnote-backlink-ref")).replace(/"/g,"&quot;").replace(/&lt;/g,"&ltsym;").replace(/&gt;/g,"&gtsym;"),n=+(p+1),k="",c=e(g[p]),q=e(b[p]),d.numberResetSelector?(k=c.closest(d.numberResetSelector),a=k.is(l)?a+1:1,l=k):a=n,0!==m.indexOf("<")&&(m="<p>"+m+"</p>"),k=d.buttonMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,a).replace(/\{\{FOOTNOTEID\}\}/g,n).replace(/\{\{FOOTNOTECONTENT\}\}/g,m),k=t(k,"SUP",c),k=t(k,"FN",q),e(k).insertBefore(c),m=q.parent(),d.actionOriginalFN.toLowerCase()){case "delete":c.remove();
q.remove();r(m);break;case "hide":c.addClass("footnote-print-only");q.addClass("footnote-print-only");r(m);break;case "ignore":c.addClass("footnote-print-only")}},y=function(a,b){var c,g,h,f;a.each(function(){var a=e(this);h="#"+a.attr("href").split("#")[1];c=a.closest("sup");g=a.find("sup");0<c.length?(f=(c.attr("id")||"")+(a.attr("id")||""),b.push(c.attr({"data-footnote-backlink-ref":f,"data-footnote-ref":h}))):(f=0<g.length?(g.attr("id")||"")+(a.attr("id")||""):a.attr("id")||"",b.push(a.attr({"data-footnote-backlink-ref":f,
"data-footnote-ref":h})))})},r=function(a){var b;a.is(":empty")||0===a.children(":not(.footnote-print-only)").length?(b=a.parent(),"delete"===d.actionOriginalFN.toLowerCase()?a.remove():a.addClass("footnote-print-only"),r(b)):a.children(":not(.footnote-print-only)").length==a.children("hr:not(.footnote-print-only)").length&&(b=a.parent(),"delete"===d.actionOriginalFN.toLowerCase()?a.remove():(a.children("hr").addClass("footnote-print-only"),a.addClass("footnote-print-only")),r(b))},z=function(a,b){0<=
b.indexOf(" ")&&(b=b.trim().replace(/ +/g,"|").replace(/(.*)/g,"($1)"));return a.replace(RegExp("(\\s|&nbsp;)*<\\s*a[^#<]*#"+b+"[^>]*>(.*?)<\\s*/\\s*a>","g"),"").replace("[]","")},t=function(a,b,c){var g=RegExp("\\{\\{"+b+":([^\\}]*)\\}\\}","g"),h,f;for(h=g.exec(a);h;)h[1]&&(f=c.attr(h[1])||"",a=a.replace("{{"+b+":"+h[1]+"}}",f)),h=g.exec(a);return a},B=function(a){if(d.activateOnHover){a=e(a.target).closest(".footnote-button");var b='[data-footnote-identifier="'+a.attr("data-footnote-identifier")+
'"]';a.hasClass("active")||(a.addClass("hover-instantiated"),d.allowMultipleFN||n(".footnote-content:not("+b+")"),u(".footnote-button"+b).addClass("hover-instantiated"))}},D=function(a){var b=e(a.target),c=b.closest(".footnote-button");$nearFootnote=b.closest(".footnote-content");0<c.length?(a.preventDefault(),C(c)):1>$nearFootnote.length&&0<e(".footnote-content").length&&n()},C=function(a){a.blur();var b='data-footnote-identifier="'+a.attr("data-footnote-identifier")+'"';a.hasClass("changing")||
(a.hasClass("active")?d.allowMultipleFN?n(".footnote-content["+b+"]"):n():(a.addClass("changing"),setTimeout(function(){a.removeClass("changing")},d.popoverCreateDelay),u(".footnote-button["+b+"]"),a.addClass("click-instantiated"),d.allowMultipleFN||n(".footnote-content:not(["+b+"])")))},u=function(a){a=a||".footnote-button";a="string"!==typeof a&&d.allowMultipleFN?a:"string"!==typeof a?a.first():d.allowMultipleFN?e(a).closest(".footnote-button"):e(a+":first").closest(".footnote-button");var b=e();
a.each(function(){var a=e(this),g;try{g=d.contentMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,a.attr("data-footnote-number")).replace(/\{\{FOOTNOTEID\}\}/g,a.attr("data-footnote-identifier")).replace(/\{\{FOOTNOTECONTENT\}\}/g,a.attr("data-footnote-content").replace(/&gtsym;/,"&gt;").replace(/&ltsym;/,"&lt;")),g=t(g,"BUTTON",a)}finally{$content=e(g);try{d.activateCallback($content)}catch(h){}d.appendPopoversTo?$content.appendTo(d.appendPopoversTo+":first"):($nearestBlock=a.closest("p, div, pre, li, ul, section, article, main, aside"),
$siblingFootnote=$nearestBlock.siblings(".footnote-content:last"),0<$siblingFootnote.length?$content.insertAfter($siblingFootnote):$content.insertAfter($nearestBlock));$content.attr("data-bigfoot-max-height",$content.height());v();a.addClass("active");$content.find(".footnote-content-wrapper").bindScrollHandler();b=b.add($content)}});setTimeout(function(){b.addClass("active")},d.popoverCreateDelay);return b};e.fn.bindScrollHandler=function(){if(d.preventPageScroll)e(this).on("DOMMouseScroll mousewheel",
function(a){var b=e(this),c=b.scrollTop(),g=b[0].scrollHeight,h=parseInt(b.css("height")),f=b.closest(".footnote-content");0<b.scrollTop()&&10>b.scrollTop()&&f.addClass("scrollable");if(f.hasClass("scrollable")){var d="DOMMouseScroll"==a.type?-40*a.originalEvent.detail:a.originalEvent.wheelDelta,k=0<d,m=function(){a.stopPropagation();a.preventDefault();return a.returnValue=!1};if(!k&&-d>g-h-c)return b.scrollTop(g),f.addClass("fully-scrolled"),m();if(k&&d>c)return b.scrollTop(0),f.removeClass("fully-scrolled"),
m();f.removeClass("fully-scrolled")}})};var E=function(a){d.deleteOnUnhover&&d.activateOnHover&&setTimeout(function(){e(a.target).closest(".footnote-content, .footnote-button");1>e(".footnote-button:hover, .footnote-content:hover").length&&n()},d.hoverDelay)},F=function(a){27==a.keyCode&&n()},n=function(a,b){a=a||".footnote-content";b=b||d.popoverDeleteDelay;var c=e(),g,h,f;e(a).each(function(){f=e(this);g=f.attr("data-footnote-identifier");h=e('.footnote-button[data-footnote-identifier="'+g+'"]');
h.hasClass("changing")||(c=c.add(h),h.removeClass("active hover-instantiated click-instantiated").addClass("changing"),f.removeClass("active").addClass("disapearing"),setTimeout(function(){f.remove();h.removeClass("changing")},b))});return c},v=function(){d.positionContent&&e(".footnote-content").each(function(){var a,b,c=e(this),g='data-footnote-identifier="'+c.attr("data-footnote-identifier")+'"';c.find(".footnote-content-wrapper");var d=e(".footnote-button["+g+"]"),f=parseFloat(d.outerWidth()),
g=parseFloat(d.outerHeight()),l=document.createElement("div");l.style.cssText="position: fixed;top: 0;left: 0;bottom: 0;right: 0;";document.documentElement.insertBefore(l,document.documentElement.firstChild);b=l.offsetWidth;a=l.offsetHeight;document.documentElement.removeChild(l);g=d.offset().top-e(window).scrollTop()+g/2;d=d.offset().left+f/2;a-=g;b=d/b;var f=parseFloat(c.css("width")),l=parseFloat(c.css("margin-top")),k=+c.attr("data-bigfoot-max-height"),m=1E4;a<2*l+k&&g>a?(c.css({top:"auto",bottom:a+
"px"}).addClass("top").removeClass("bottom"),m=g-l-15,c.css({"transform-origin":100*b+"% 100%"})):(c.css({bottom:"auto",top:g+"px"}).addClass("bottom").removeClass("top"),m=a-l-15,c.css({"transform-origin":100*b+"% 0%"}));c.find(".footnote-content-wrapper").css({"max-height":Math.min(m,k)+"px"});c.css({left:d-b*f+"px"});g=b||0.5;d=c.find(".tooltip");0<d.length&&d.css({left:100*g+"%"});parseInt(c.css("height"))<c.find(".footnote-content-wrapper")[0].scrollHeight&&c.addClass("scrollable")})},G=function(a,
b,c,g,e){b=b||d.popoverDeleteDelay;if(null===c||!1!==c)c=!0;var f,l;"string"===typeof a?(f="iphone"===a.toLowerCase()?"<320px":"ipad"===a.toLowerCase()?"<768px":a,f=(l=">"===f.charAt(0)?"min":"<"===f.charAt(0)?"max":null)?"("+l+"-width: "+f.substring(1)+")":f,f=window.matchMedia(f)):f=a;if(f.media&&"invalid"===f.media)return{added:!1,mq:f,listener:null};var k="max"===l;g=g||w(c,b,"min"===l,function(a){a.addClass("fixed-bottom")});e=e||w(c,b,k,function(){});b=function(a){a.matches?g(c,s):e(c,s)};f.addListener(b);
b(f);d.breakpoints[a]={added:!0,mq:f,listener:b};return d.breakpoints[a]},w=function(a,b,c,d){return function(a,f){var e;a&&(e=f.close(),f.updateSetting("activateCallback",d));setTimeout(function(){f.updateSetting("positionContent",c);a&&f.activate(e)},b)}};e(document).ready(function(){A();e(document).on("mouseenter",".footnote-button",B);e(document).on("touchend click",D);e(document).on("mouseout",".hover-instantiated",E);e(document).on("keyup",F);e(window).on("scroll resize",v)});return s={close:function(a,
b){return n(a,b)},activate:function(a){return u(a)},reposition:function(){return v()},addBreakpoint:function(a,b,c,d,e){return G(a,b,c,d,e)},removeBreakpoint:function(a,b){var c;if("string"===typeof a)mqFound=void 0!==d.breakpoints[a];else for(c in d.breakpoints)if(d.breakpoints.hasOwnProperty(c)&&d.breakpoints[c].mq===a){mqFound=!0;break}if(mqFound){var e=d.breakpoints[c||a];b?b({matches:!1}):e.listener({matches:!1});e.mq.removeListener(e.listener);delete d.breakpoints[c||a]}return mqFound},getSetting:function(a){return d[a]},
updateSetting:function(a,b){var c;if("string"===typeof a)c=d[a],d[a]=b;else{c={};for(var e in a)a.hasOwnProperty(e)&&(c[e]=d[e],d[e]=a[e])}return c}}}})(jQuery);
